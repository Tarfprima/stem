{% extends 'stem/base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<h1>{{ user.username }}</h1>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á -->
<p>–í—Å–µ–≥–æ –∑–∞–¥–∞—á: {{ total_tasks }}</p>
<p>–ê–∫—Ç–∏–≤–Ω—ã—Ö: {{ active_count }}</p>
<p>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö: {{ completed_count }}</p>

<!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
<div class="section-header">
  <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
  <div class="search-container">
    <input 
      type="text" 
      id="searchActiveTask" 
      class="search-input" 
      placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." 
      autocomplete="off"
    >
    <select id="sortActiveTask" class="sort-select">
      <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
      <option value="date-desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="date-asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
    </select>
    <select id="filterActiveTask" class="filter-select">
      <option value="all">–í—Å–µ</option>
      <option value="notes">–¢–æ–ª—å–∫–æ –∑–∞–º–µ—Ç–∫–∏</option>
      <option value="reminders">–¢–æ–ª—å–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</option>
    </select>
    <div class="search-results-count" id="activeResultsCount"></div>
  </div>
</div>
<ul class="tasks-grid active-tasks" data-section="active"> {# <--- –î–û–ë–ê–í–õ–ï–ù –ö–õ–ê–°–° #}
  {% for task in active_page %}
    <li class="task-item {% if task.reminder_time %}reminder{% else %}note{% endif %}">
      <div class="task-header">
        <span class="task-icon">
          {% if task.reminder_time %}‚è∞{% else %}üìù{% endif %}
        </span>
        <strong class="task-title">{{ task.title }}</strong>
      </div>

      {% if task.description %}
        <p class="task-desc">{{ task.description }}</p>
      {% endif %}

      <div class="task-meta">
        <small>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at|date:"d.m.Y H:i" }}</small>
        {% if task.reminder_time %}
          <small class="reminder-time">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {{ task.reminder_time|date:"d.m.Y H:i" }}</small>
        {% endif %}
      </div>

      <div class="task-actions">
        <form method="post" action="{% url 'stem:complete_task' task.id %}" class="task-action-form">
          {% csrf_token %}
          <button type="submit" class="btn btn-complete">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
        </form>
        <form method="post" action="{% url 'stem:delete_task' task.id %}" class="task-action-form">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    </li>
  {% empty %}
    <li class="empty-state">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç.</li>
  {% endfor %}
</ul>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<div class="pagination">
  {% if active_page.has_previous %}
    <a href="?page={{ active_page.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
  {% endif %}
  <span>–°—Ç—Ä. {{ active_page.number }} –∏–∑ {{ active_page.paginator.num_pages }}</span>
  {% if active_page.has_next %}
    <a href="?page={{ active_page.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
  {% endif %}
</div>

<!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
<div class="section-header">
  <h2>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
  <div class="search-container">
    <input 
      type="text" 
      id="searchCompletedTask" 
      class="search-input" 
      placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." 
      autocomplete="off"
    >
    <select id="sortCompletedTask" class="sort-select">
      <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
      <option value="date-desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="date-asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
    </select>
    <select id="filterCompletedTask" class="filter-select">
      <option value="all">–í—Å–µ</option>
      <option value="notes">–¢–æ–ª—å–∫–æ –∑–∞–º–µ—Ç–∫–∏</option>
      <option value="reminders">–¢–æ–ª—å–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</option>
    </select>
    <div class="search-results-count" id="completedResultsCount"></div>
  </div>
</div>
<ul class="tasks-grid completed-tasks" data-section="completed"> {# <--- –î–û–ë–ê–í–õ–ï–ù –ö–õ–ê–°–° #}
  {% for task in completed_tasks %}
    <li class="task-item completed">
      <div class="task-header">
        <span class="task-icon">‚úÖ</span>
        <strong class="task-title">{{ task.title }}</strong>
      </div>
      <div class="task-meta">
        <small>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at|date:"d.m.Y H:i" }}</small>
      </div>
      <div class="task-actions">
        <form method="post" action="{% url 'stem:delete_task' task.id %}" class="task-action-form">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    </li>
  {% empty %}
    <li class="empty-state">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç.</li>
  {% endfor %}
</ul>

<!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–æ) -->
<div class="section-header">
  <h2>–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–æ ({{ overdue_count }})</h2>
</div>
<ul class="tasks-grid overdue-tasks">
  {% for task in overdue_tasks %}
    <li class="task-item overdue {% if task.reminder_time %}reminder{% else %}note{% endif %}">
      <div class="task-header">
        <span class="task-icon">
          {% if task.reminder_time %}‚è∞{% else %}üìù{% endif %}
        </span>
        <strong class="task-title">{{ task.title }}</strong>
      </div>

      {% if task.description %}
        <p class="task-desc">{{ task.description }}</p>
      {% endif %}

      <div class="task-meta">
        <small>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at|date:"d.m.Y H:i" }}</small>
        {% if task.reminder_time %}
          <small class="reminder-time">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {{ task.reminder_time|date:"d.m.Y H:i" }}</small>
        {% endif %}
      </div>

      <div class="task-actions">
        <form method="post" action="{% url 'stem:complete_task' task.id %}" class="task-action-form">
          {% csrf_token %}
          <button type="submit" class="btn btn-complete">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
        </form>
        <form method="post" action="{% url 'stem:delete_task' task.id %}" class="task-action-form">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    </li>
  {% empty %}
    <li class="empty-state">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç.</li>
  {% endfor %}
</ul>

{% endblock %}